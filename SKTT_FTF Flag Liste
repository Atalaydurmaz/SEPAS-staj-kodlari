--create table #tmp 
--(INTOPBEL VARCHAR (17) collate Turkish_CI_AI)

--Insert into #tmp
--(INTOPBEL)
--select tt.INTOPBEL from SepasTM1DB..ZBI_T_FATURA_RAP tt where tt.INTOPBEL<>''

--drop table #tmp

------

select
--t.MANDT as [�st birim],
t.ANLAGE as [Tesisat],
t.ZZSAYACID as [Saya� ID],
t.POINTOFDELIVERY as [Say�m nok.tnm.],
--t.VREFER as [Eski Sist.S�z.No],
t.VKONT as [S�zle�me hesab�],
t.ABWVK as [Toplu ftr.hsp.],
--t.VERTRAG as [S�zle�me],
t.PARTNER as [Muhatap],
t.NAME as [Muhatab�n Tan�m�],
t.ZZSOZLESMETUR as [S�zle�me t�r�],
t.ZZSOZLESMETUR_TEXT as [S�zle�me t�r� tan�m�],
t.VERGI_NO as [Vergi No],
t.OPBEL as [Yzdm.blg.],
t.ZZTOP_FATNO as [Toplu Fatura No],
t.REV_ERNAM as [Fatura TK Alan Kulla],
t.GIB_SEND as [G�B'e G�nderildi],
t.MAIL_SEND as [Mail G�nderildi],
t.EFATURA as [E-Fatura],
t.ZZMATBU_NO as [Matbu No],
t.ILK_OKUMA_TARIHI as [�lk Okuma Tarihi],
t.SON_OKUMA_TARIHI as [Son Okuma Tarihi],
--t.ABRVORG as [Tahakkuk i�lemi],
t.ABRVORG_TEXT as [Tahakkuk ��lemi Tan�m�],
--t.SOZ_GUCU as [S�zle�me G�c�],
--t.KUR_GUCU as [Kurulu G��],
t.CARPAN as [�arpan],
--t.CEP_NUMBER as [Telefon],
--t.TCNO as [TC Kimlik No],
--t.VERGI_DAIRESI as [Vergi Dairesi],
--t.VERART as [Mhspl�t.t�r�],
t.ZZTERIM_TEXT as [Terim Tan�m�],
t.OSB_GROUP as [Yerinde thk.gr.],
--t.GERAET as [Cihaz],
--t.EGERR_INFO as [Saya� Marka/Tip],
t.BUDAT as [Kay�t tarihi],
t.DISTRIBUTOR as [Da��t�m �irketi],
t.BILLING_PERIOD as [D�nem],
t.TARIFTYP as [Tarife tipi],
--t.ABONE_GRUBU as [Abone Grubu],
t.TARIFTYP_TEXT as [Abone Grubu Tan�m�],
t.ERNAM as [Yaratan],
t.ERDAT as [Yaratma trh.],
t.DRUCKDAT as [Yazd�rma tarihi],
t.FAEDN as [Net �dm.vd.trh.],
t.EINZDAT as [Abonelik tarihi],
--t.AUSZDAT as [Abon�ptTr],
t.AUSZDAT as [G�ncelAbone�ptalTrh.],
--t.ZAHLKOND as [�deme ko�ulu],
SUM (t.TAHAKKUK_SAYISI) as [Tahakkuk Say�s�],
SUM (t.E0_ILK) as [E0 �lk Endeks],
SUM (t.E1_ILK) as [E1 �lk Endeks],
SUM (t.E2_ILK) as [E2 �lk Endeks],
SUM (t.E3_ILK) as [E3 �lk Endeks],
SUM (t.E0_SON) as [E0 Son Endeks],
SUM (t.E1_SON) as [E1 Son Endeks],
SUM (t.E2_SON) as [E2 Son Endeks],
SUM (t.E3_SON) as [E3 Son Endeks],
SUM (t.RI_ILK) as [RI �lk Endeks],
SUM (t.RI_SON) as [RI Son Endeks],
SUM (t.RC_ILK) as [RC �lk Endeks],
SUM (t.RC_SON) as [RC Son Endeks],
SUM (t.P_OKUNAN) as [P Okunan],
SUM (t.T0) as [T0 T�ketim],
SUM (t.T1) as [T1 T�ketim],
SUM (t.T2) as [T2 T�ketim],
SUM (t.T3) as [T3 T�ketim],
SUM (t.T0_TK_TUK) as [T0 TK T�ketimi],
SUM (t.T1_TK_TUK) as [T1 TK T�ketimi],
SUM (t.T2_TK_TUK) as [T2 TK T�ketimi],
SUM (t.T3_TK_TUK) as [T3 TK T�ketimi],
SUM (t.RI) as [RI T�ketim],
SUM (t.RC) as [RC T�ketim],
--SUM (t.REAKTIF_TUK) as [Reaktif T�ketim],
SUM (t.YEKDEM_TUK) as [YEKDEM T�ketim],
SUM (t.GUC_ASIM_TUK) as [G�� A��m T�ketim],
SUM (t.GUC_TUK) as [G�� T�ketim],
SUM (t.P) as [P T�ketim],
--SUM (t.T0_FIYAT) as [T0 Fiyat�],
--SUM (t.T1_FIYAT) as [T1 Fiyat�],
--SUM (t.T2_FIYAT) as [T2 Fiyat�],
--SUM (t.T3_FIYAT) as [T3 Fiyat�],
--SUM (t.DAG_FIYATI) as [Da��t�m Fiyat�],
--SUM (t.REAKTIF_FIYATI) as [Reaktif Fiyat�],
--SUM (t.GUC_ASIM_FIYATI) as [G�� A��m Fiyat�],
--SUM (t.GUC_FIYATI) as [G�� Fiyat�],
--SUM (t.YEKDEM_FIYAT) as [YEKDEM Fiyat�],
SUM (t.T0_TUTAR) as [T0 Tutar],
SUM (t.T1_TUTAR) as [T1 Tutar],
SUM (t.T2_TUTAR) as [T2 Tutar],
SUM (t.T3_TUTAR) as [T3 Tutar],
SUM (t.T0_TK_BEDELI) as [T0 TK Bedeli],
SUM (t.T1_TK_BEDELI) as [T1 TK Bedeli],
SUM (t.T2_TK_BEDELI) as [T2 TK Bedeli],
SUM (t.T3_TK_BEDELI) as [T3 TK Bedeli],
SUM (t.DAG_BEDELI) as [Da��t�m Tutar�],
SUM (t.RI_BEDELI) as [RI Bedeli],
SUM (t.RC_BEDELI) as [RC Bedeli],
SUM (t.REAKTIF_BEDELI) as [Reaktif Tutar�],
SUM (t.ENERJI_FONU_TUTARI) as [EF Tutar�],
SUM (t.TRT_TUTARI) as [TRT Tutar�],
SUM (t.BTV_TUTARI) as [BTV Tutar�],
SUM (t.GUC_ASIM_BEDELI) as [G�� A��m Tutar�],
SUM (t.GUC_BEDELI) as [G�� Tutar�],
SUM (t.YEKDEM_BEDELI) as [YEKDEM Tutar�],
SUM (t.T0_EKTUK+isnull(t.T0_EKTUK_K2,0))as[T0 Ek T�ketim] ,
SUM (t.T1_EKTUK+isnull(t.T1_EKTUK_K2,0)) as [T1 Ek T�ketim],
SUM (t.T2_EKTUK+isnull(t.T2_EKTUK_K2,0)) as [T2 Ek T�ketim],
SUM (t.T3_EKTUK+isnull(t.T3_EKTUK_K2,0)) as [T3 Ek T�ketim],
SUM (t.RI_EKTUK) as [RI Ek T�ketim],
SUM (t.RC_EKTUK) as [RC Ek T�ketim],
t.GDDK_NEDENI as [GDDK/Ek T�ketim Nede],
SUM (t.GUC_ASIM_EKTUK) as [G�� A��m Ek T�ketim],
SUM (t.GUC_EKTUK) as [G�� Ek T�ketim],
SUM (t.YEKDEM_EKTUK) as [YEKDEM Ek T�ketim],
SUM (t.EKTUK_TUTARI+ isnull(t.EKTUK_TUTARI_K2,0)) as [Ek T�ketim Tutar�],
SUM (t.GUVENCE_BEDELI) as [G�vence Bedeli],
--t.ENERJI_FONU_ORANI as [EF Oran�],
--t.TRT_ORANI as [TRT Oran�],
--t.BTV_ORANI as [BTV Oran�],
--SUM (t.KULL_BEDELI) as [Kullan�m Bedeli],
--SUM (t.FON_BEDELI) as [Fon Bedelleri],
--t.T0_INDOR as [T0 �ndirim Oran�],
--t.T1_INDOR as [T1 �ndirim Oran�],
--t.T2_INDOR as [T2 �ndirim Oran�],
--t.T3_INDOR as [T3 �ndirim Oran�],
--t.T0_TK_FIYAT as [T0 TK Fiyat�],
--t.T1_TK_FIYAT as [T1 TK Fiyat�],
--t.T2_TK_FIYAT as [T2 TK Fiyat�],
--t.T3_TK_FIYAT as [T3 TK Fiyat�],
SUM (t.TUIK_AKTIF_ENERJI) as [T��K Aktif Enerji Bedeli],
SUM (t.TUIK_DAGITIM_FON) as [T��K Da��t�m Fon Bedeli],
SUM (t.AK_BEDELI) as [A�ma-Kesme Bedeli],
SUM (t.SOKME_TAKMA_BEDELI) as [S�kme Takma Bedeli],
SUM (t.SK_BEDELI) as [Saya� Kontrol Bedeli],
SUM (t.KDV) as [KDV],
SUM (t.MUSTERI_ALACAGI) as [M��teri Alaca��],
--t.YEKDEM_GNL_FIYAT as [YEKDEM Genel Fiyat],
--SUM (t.YEKDEM_CAP) as [YEKDEM CAP],
SUM (t.TENZIL_ILAVE) as [Tenzil/�lave],
SUM (t.TENZIL_ILAVE_KDV) as [Tenzil/�lave KDV],
t.GUN_ORT_TUK as [G�nl�k Ortalama T�ketim],
t.YILLIK_TUK as [Y�ll�k T�ketim],
t.ONCEKI_YIL_TUK as [�nceki Y�l T�ketim],
SUM (t.GEC_BEDELI) as [Gecikme Bedeli],
SUM (t.GEC_BEDELI_KDV) as [Gecikme Bedeli KDV],
--t.KAR as [K�r],
--t.KAR_ULUSAL_TOPLAM as [K�r Ulusal Toplam],
--t.KAR_SEPAS_TOPLAM as [K�r SEPA� Toplam],
--t.ROUNDO as [Eski Yuvarlama],
--t.ROUND as [Yeni Yuvarlama],
SUM (t.KDV_MATRAHI) as [KDV Matrah�],
SUM (t.FATURA_TUTARI) as [Fatura Tutar�],
SUM (t.TOTAL_AMNT) as [Toplam �denecek Tutar],
SUM (t.T0_SKTTLI) as [SKTTli T0 T�ketim],
SUM (t.T1_SKTTLI) as [SKTTli T1 T�ketim],
SUM (t.T2_SKTTLI) as [SKTTli T2 T�ketim],
SUM (t.T3_SKTTLI) as [SKTTli T3 T�ketim],
SUM (t.T0_TUTAR_SKTTLI) as [SKTTli T0 Tutar],
SUM (t.T1_TUTAR_SKTTLI) as [SKTTli T1 Tutar],
SUM (t.T2_TUTAR_SKTTLI) as [SKTTli T2 Tutar],
SUM (t.T3_TUTAR_SKTTLI) as [SKTTli T3 Tutar],
SUM (t.T0_TK_TUK_SKTTLI) as [SKTTli T0 TK T�ketim],
SUM (t.T1_TK_TUK_SKTTLI) as [SKTTli T1 TK T�ketim],
SUM (t.T2_TK_TUK_SKTTLI) as [SKTTli T2 TK T�ketim],
SUM (t.T3_TK_TUK_SKTTLI) as [SKTTli T3 TK T�ketim],
SUM (t.T0_TK_BEDELI_SKTTLI) as [SKTTli T0 TK Bedeli],
SUM (t.T1_TK_BEDELI_SKTTLI) as [SKTTli T1 TK Bedeli],
SUM (t.T2_TK_BEDELI_SKTTLI) as [SKTTli T2 TK Bedeli],
SUM (t.T3_TK_BEDELI_SKTTLI) as [SKTTli T3 TK Bedeli],
sUM (t.T0_EKTUK_SKTTLI) as [SKTTli T0 Ek T�ketim],
SUM (t.T1_EKTUK_SKTTLI) as [SKTTli T1 Ek T�ketim],
SUM (t.T2_EKTUK_SKTTLI) as [SKTTli T2 Ek T�ketim],
SUM (t.T3_EKTUK_SKTTLI) as [SKTTli T3 Ek T�ketim],
SUM (t.EKTUK_TUTARI_SKTTLI) as [SKTTli Ek T�ketim Tutar�],
SUM (t.LIS_T0EKTUK_SKTTLI) as [SKTTli Lisanss�z �retim Mahsup T0],
SUM (t.LIS_T1EKTUK_SKTTLI) as [SKTTli Lisanss�z �retim Mahsup T1],
SUM (t.LIS_T2EKTUK_SKTTLI) as [SKTTli Lisanss�z �retim Mahsup T2],
SUM (t.LIS_T3EKTUK_SKTTLI) as [SKTTli Lisanss�z �retim Mahsup T3],
SUM (t.LIS_EKTUKTUTARI_SKTTLI) as [SKTTli Lisanss�z �retim Mahsup Tutar�],

t.RI_T0_ORANI as [End./Aktif T�k. Oran],
t.RC_T0_ORANI as [Kap./Aktif T�k. Oran],
t.STOKZ as [Belge ters kyt.],
t.INTOPBEL as [Trs.kyt.blg.no.],
--t.REASON as [Ters kyt.nedeni],
--t.REASON_TEXT as [Ters Kay�t Nedeni Ta],
--t.BIRIM as [Hataya Sebep Olan Bi],
--t.BIRIM_TEXT as [Birim Tan�m�],
--t.TESPIT as [Hata Tespiti],
--t.TESPIT_TEXT as [Tespit Tan�m�],
--t.TEXT as [Ters Kay�t A��klama],
--t.BELGENO as [�ade Belge No],
t.REV_ERDAT as [Fatura TK Tarihi],
--t.REV_ERZET as [Fatura TK Saati],
--t.ZZFATURAILETIM as [Fatura iletim Yolu],
t.ZZFATURAILETIM_TEXT as [Fatura �letim Yolu T],
t.TESIS_ADRESI as [Tesis Adresi],
t.ADRES as [Adres],
t.ILCE as [Yerle�im yeri],
t.IL as [Tan�m],
--t.AEZET as [De�i�iklik sa.],
--t.AEDAT as [D��k.tarihi],
--t.AENAM as [De�i�tiren]
t.ICMAL_DONEMI,
t.PTF_FLAG

from SepasTM1DB..ZBI_T_FATURA_RAP t
--left outer join SepasTM1DB..Z_EVER ys (nolock) on  ys.vkonto=t.vkont 
 
where --BILLING_PERIOD between '2018/11' and '2018/11'
	  --and t.ERDAT between '2018-02-26' and '2018-02-26'
	  -- t.ANLAGE in ('0010881194') --tesisat no
	  --and t.ZZSAYACID in ('') --saya� ID
	  --t.VKONT in ('100101167647') --s�zle�me hesap no
	  --and t.ABWVK in ('') --toplu s�zle�me hesab�
	  --and t.ZZSOZLESMETUR between '0001' and '0004' --ulusal
	  --and t.ZZSOZLESMETUR between '0005' and '0010' --st
	  --and t.OPBEL in ('') --yazd�rma belge no
	  --and t.ERNAM not in ('RFC-IMA') --belge olu�turan
	  --t.PTF_FLAG in('X')
	  (t.T0_SKTTLI<>0 or t.T0_TK_TUK_SKTTLI<>0 or T0_EKTUK_SKTTLI<>0 or LIS_T0EKTUK_SKTTLI<>0 ) 
	  and t.ICMAL_DONEMI in ('2025/06')

	--  and t.OPBEL not like '7%'  --ters kay�t belgeleri gelmez
	  --and t.INTOPBEL = ' ' --ters kay�t al�nmayan faturalar� getirir
	--  and t.OPBEL not in (select INTOPBEL from #tmp)
group by 

t.ANLAGE, t.ZZSAYACID,
t.POINTOFDELIVERY,
--t.VREFER,
t.VKONT,
t.ABWVK,
--t.VERTRAG,
t.PARTNER,
t.NAME,
t.ZZSOZLESMETUR,
t.ZZSOZLESMETUR_TEXT,
t.VERGI_NO,
t.OPBEL,
t.ZZTOP_FATNO,
t.REV_ERNAM,
t.GIB_SEND,
t.MAIL_SEND,
t.EFATURA,
t.ZZMATBU_NO,
t.ILK_OKUMA_TARIHI,
t.SON_OKUMA_TARIHI,
--t.ABRVORG,
t.ABRVORG_TEXT,
--t.SOZ_GUCU,
--t.KUR_GUCU,
t.CARPAN,
--t.CEP_NUMBER,
--t.TCNO,
--t.VERGI_DAIRESI,
--t.VERART,
t.ZZTERIM_TEXT,
t.OSB_GROUP,
--t.GERAET,
--t.EGERR_INFO,
t.BUDAT,
t.DISTRIBUTOR,
t.BILLING_PERIOD,
t.TARIFTYP,
--t.ABONE_GRUBU],
t.TARIFTYP_TEXT,
t.ERNAM,
t.ERDAT,
t.DRUCKDAT,
t.FAEDN,
t.EINZDAT,
--t.AUSZDAT,
--t.ZAHLKOND,
t.GDDK_NEDENI,
t.GUN_ORT_TUK,
t.YILLIK_TUK,
t.ONCEKI_YIL_TUK,
t.RI_T0_ORANI,
t.RC_T0_ORANI,
t.STOKZ,
t.INTOPBEL,
--t.REASON,
--t.REASON_TEXT,
--t.BIRIM,
--t.BIRIM_TEXT,
--t.TESPIT,
--t.TESPIT_TEXT,
--t.TEXT,
--t.BELGENO,
t.REV_ERDAT,
--t.REV_ERZET,
--t.ZZFATURAILETIM,
t.ZZFATURAILETIM_TEXT,
t.TESIS_ADRESI,
t.ADRES,
t.ILCE,
t.IL,
t.TOTAL_AMNT,
t.AUSZDAT,
t.ICMAL_DONEMI,
t.PTF_FLAG
--t.AEZET,
--t.AEDAT,
--t.AENAM


--having sum (t.TOTAL_AMNT) > 3000

order by t.TOTAL_AMNT desc
